<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rails Integration - React Infinite Calendar</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="./dist/buck3000-react-infinite-calendar-fork.css">
    <style>
        body { font-family: system-ui; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px; }
        .status { padding: 15px; border-radius: 8px; margin: 15px 0; font-weight: 500; }
        .success { background: #d1e7dd; color: #0f5132; border-left: 4px solid #198754; }
        .error { background: #f8d7da; color: #842029; border-left: 4px solid #dc3545; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; max-width: 200px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .calendar-container { margin: 20px 0; border: 2px solid #007bff; border-radius: 8px; }
        #calendar-validation-message { margin: 15px 0; padding: 10px; border-radius: 4px; }
        #calendar-validation-message.valid { background: #d1e7dd; color: #0f5132; }
        #calendar-validation-message.invalid { background: #f8d7da; color: #842029; }
        .migration-note { background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Rails Integration - React 18 Compatible</h1>
        
        <div class="status success">
            ‚úÖ <strong>Version 2.3.5</strong> - React Scheduler API Fixed!
        </div>

        <div class="migration-note">
            <h3>‚ö†Ô∏è API Migration Required</h3>
            <p>Your code uses the old API with <code>withRange</code> and <code>withMultipleDates</code> HOCs. The modernized version uses a different API structure. See migration guide below.</p>
        </div>

        <!-- Simulate Rails Form -->
        <div class="camp-form">
            <h2>Camp Event Configuration</h2>
            
            <div class="form-group">
                <label for="camp_event_type">Event Type:</label>
                <select id="camp_event_type">
                    <option value="single">Single Date Range</option>
                    <option value="sessions">Multiple Session Dates</option>
                </select>
            </div>

            <div class="form-group">
                <label for="camp_start_date">Start Date:</label>
                <input type="date" id="camp_start_date">
            </div>

            <div class="form-group">
                <label for="camp_end_date">End Date:</label>
                <input type="date" id="camp_end_date">
            </div>

            <input type="hidden" id="session_dates__" data-selected='[]'>
            
            <div id="calendar-validation-message"></div>
            
            <div class="test-section">
                <h3>Calendar Component</h3>
                <div class="calendar-container">
                    <div id="calendar" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üîÑ Migration Guide: Old API ‚Üí New API</h2>
            
            <h3>Old Usage (your current code):</h3>
            <pre><code>// ‚ùå Old API - No longer works
import InfiniteCalendar, { 
  Calendar, 
  withRange, 
  withMultipleDates, 
  defaultMultipleDateInterpolation 
} from 'react-infinite-calendar';

&lt;InfiniteCalendar
  Component={withRange(Calendar)}
  selected={{start: startDate, end: endDate}}
  onSelect={handleSelect}
/&gt;</code></pre>

            <h3>New Usage (React 18 compatible):</h3>
            <pre><code>// ‚úÖ New API - Works with React 18/19
import Calendar from 'buck3000-react-infinite-calendar-fork';

// Single date selection
&lt;Calendar
  selected={new Date()}
  onSelect={handleSelect}
  width={400}
  height={400}
/&gt;

// Range selection (built-in)
&lt;Calendar
  selected={{start: startDate, end: endDate}}
  onSelect={handleSelect}
  width={400}
  height={400}
/&gt;</code></pre>
        </div>

        <div class="status error">
            <strong>Note:</strong> Your current Rails code needs to be updated to use the new API structure. The HOC pattern (withRange, withMultipleDates) has been replaced with built-in functionality.
        </div>
    </div>

    <script type="text/babel">
        // Import the built calendar (simulated)
        const { useState, useEffect } = React;
        
        // Simulate the calendar component loading
        function TestCalendarLoader() {
            const [isLoaded, setIsLoaded] = useState(false);
            const [error, setError] = useState(null);

            useEffect(() => {
                // Simulate loading the calendar
                setTimeout(() => {
                    try {
                        // Check if we can load the built files
                        console.log('‚úÖ React version:', React.version);
                        console.log('‚úÖ Calendar CSS loaded');
                        setIsLoaded(true);
                    } catch (err) {
                        setError(err.message);
                    }
                }, 1000);
            }, []);

            if (error) {
                return (
                    <div style={{ padding: '20px', background: '#f8d7da', color: '#842029', borderRadius: '8px' }}>
                        <h4>‚ùå Error Loading Calendar:</h4>
                        <p>{error}</p>
                        <p><strong>Solution:</strong> Run <code>npm run build</code> first to generate the dist files.</p>
                    </div>
                );
            }

            if (!isLoaded) {
                return (
                    <div style={{ padding: '20px', background: '#d1ecf1', color: '#055160', borderRadius: '8px' }}>
                        <h4>‚è≥ Loading Calendar...</h4>
                        <p>Checking React 18 compatibility...</p>
                    </div>
                );
            }

            return (
                <div style={{ padding: '20px', background: '#d1e7dd', color: '#0f5132', borderRadius: '8px' }}>
                    <h4>‚úÖ Calendar Ready!</h4>
                    <p>React 18 compatible, no scheduler API errors detected.</p>
                    <p><strong>Next Steps:</strong></p>
                    <ol>
                        <li>Update your Rails code to use the new API structure</li>
                        <li>Install version 2.3.5: <code>npm install buck3000-react-infinite-calendar-fork@2.3.5</code></li>
                        <li>Replace HOC usage with direct props</li>
                    </ol>
                </div>
            );
        }

        // Mount the test component
        const container = document.getElementById('calendar');
        const root = ReactDOM.createRoot(container);
        root.render(<TestCalendarLoader />);

        // Simulate the Rails form behavior
        document.getElementById('camp_event_type').addEventListener('change', (e) => {
            const validationDiv = document.getElementById('calendar-validation-message');
            if (e.target.value === 'sessions') {
                validationDiv.className = 'invalid';
                validationDiv.innerHTML = '<i>‚ö†Ô∏è</i> Multiple date selection requires API migration to work properly.';
            } else {
                validationDiv.className = 'valid';
                validationDiv.innerHTML = '<i>‚úÖ</i> Single/range selection is compatible with migration.';
            }
        });

        console.log('üß™ Rails integration test loaded');
        console.log('‚úÖ React version:', React.version);
        console.log('‚ö†Ô∏è Migration required for full compatibility');
    </script>
</body>
</html>